<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinguaFlow - Language Learning App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=OpenDyslexic&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #6B8E7B;
            --primary-light: #8FBC8F;
            --secondary: #E8D5C4;
            --accent: #D4A373;
            --bg: #F5F5F0;
            --text: #2C3E50;
            --text-light: #5D6D7E;
            --white: #FFFFFF;
            --success: #7FB069;
            --warning: #F4A261;
            --error: #E76F51;
            --dyslexia-bg: #FFF8E7;
            --dyslexia-text: #000000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, font-family 0.3s, line-height 0.3s;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        body.dyslexia-mode {
            font-family: 'OpenDyslexic', sans-serif;
            background: var(--dyslexia-bg);
            color: var(--dyslexia-text);
            line-height: 2;
            letter-spacing: 0.05em;
            word-spacing: 0.1em;
        }

        body.dyslexia-mode .card,
        body.dyslexia-mode .btn,
        body.dyslexia-mode input,
        body.dyslexia-mode select,
        body.dyslexia-mode textarea {
            border: 2px solid var(--dyslexia-text);
            box-shadow: none;
        }

        /* Navigation */
        .navbar {
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        body.dyslexia-mode .navbar {
            background: var(--dyslexia-bg);
            border-bottom: 3px solid var(--dyslexia-text);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 500;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary);
            background: var(--secondary);
        }

        /* Dyslexia Toggle */
        .dyslexia-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--secondary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
        }

        .toggle-switch {
            width: 50px;
            height: 26px;
            background: var(--text-light);
            border-radius: 13px;
            position: relative;
            transition: 0.3s;
        }

        .toggle-switch.active {
            background: var(--primary);
        }

        .toggle-slider {
            width: 22px;
            height: 22px;
            background: var(--white);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            left: 26px;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        body.dyslexia-mode .card {
            background: var(--white);
        }

        .card-header {
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.75rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-light);
        }

        /* Buttons */
        .btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 142, 123, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--accent);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* Language Grid */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .language-card {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .language-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(107, 142, 123, 0.2);
        }

        .language-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            color: var(--white);
        }

        .language-flag {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .language-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .language-level {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        /* Test Styles */
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .progress-bar {
            background: var(--secondary);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.5s;
        }

        .question-card {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .question-number {
            color: var(--primary);
            font-weight: 600;
        }

        .audio-btn {
            background: var(--accent);
            color: var(--white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .audio-btn:hover {
            transform: scale(1.1);
        }

        .question-text {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .options-grid {
            display: grid;
            gap: 1rem;
        }

        .option {
            background: var(--bg);
            border: 2px solid transparent;
            padding: 1.25rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .option:hover {
            border-color: var(--primary);
            background: var(--secondary);
        }

        .option.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: var(--white);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .option.selected .option-letter {
            background: var(--white);
            color: var(--primary);
        }

        /* Lessons */
        .lesson-path {
            position: relative;
            padding: 2rem 0;
        }

        .path-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            transform: translateX(-50%);
        }

        .lesson-node {
            display: flex;
            align-items: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .lesson-node:nth-child(even) {
            flex-direction: row-reverse;
        }

        .lesson-content {
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem;
            width: 45%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
        }

        .lesson-node:nth-child(even) .lesson-content {
            text-align: right;
        }

        .lesson-dot {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1.25rem;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid var(--white);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .lesson-dot.locked {
            background: var(--text-light);
        }

        .lesson-dot.completed {
            background: var(--success);
        }

        .lesson-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .lesson-desc {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .lesson-lock {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--text-light);
        }

        .free-badge {
            background: var(--success);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 0.5rem;
        }

        /* Admin Dashboard */
        .admin-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }

        .admin-sidebar {
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem;
            height: fit-content;
        }

        .admin-menu-item {
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 0.5rem;
            transition: 0.3s;
        }

        .admin-menu-item:hover, .admin-menu-item.active {
            background: var(--secondary);
            color: var(--primary);
        }

        .admin-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
        }

        .content-editor {
            margin-top: 1.5rem;
        }

        .editor-field {
            margin-bottom: 1.5rem;
        }

        .editor-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .editor-input, .editor-textarea {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            background: var(--bg);
        }

        body.dyslexia-mode .editor-input,
        body.dyslexia-mode .editor-textarea {
            background: var(--white);
            border: 2px solid var(--dyslexia-text);
        }

        .editor-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: modalIn 0.3s;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .language-grid {
                grid-template-columns: 1fr;
            }

            .admin-grid {
                grid-template-columns: 1fr;
            }

            .lesson-content {
                width: 70%;
            }

            .lesson-node:nth-child(even) .lesson-content {
                text-align: left;
            }

            .lesson-node:nth-child(even) {
                flex-direction: row;
            }
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .mt-2 {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <span>üåê</span>
            <span>LinguaFlow</span>
        </div>
        <div class="nav-links">
            <a class="nav-link active" onclick="showSection('dashboard')">Dashboard</a>
            <a class="nav-link" onclick="showSection('test')">Placement Test</a>
            <a class="nav-link" onclick="showSection('lessons')">My Lessons</a>
            <a class="nav-link" onclick="showSection('admin')">Admin</a>
            
            <div class="dyslexia-toggle" onclick="toggleDyslexia()">
                <span>‚ôø</span>
                <span>Dyslexia Mode</span>
                <div class="toggle-switch" id="dyslexiaSwitch">
                    <div class="toggle-slider"></div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="card">
                <div class="card-header text-center">
                    <h1 class="card-title">Welcome to Your Language Journey</h1>
                    <p class="card-subtitle">Select a language to begin learning or continue your progress</p>
                </div>
            </div>

            <div class="language-grid">
                <div class="language-card" onclick="selectLanguage('english')">
                    <div class="language-flag">üá¨üáß</div>
                    <div class="language-name">English</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
                <div class="language-card" onclick="selectLanguage('dutch')">
                    <div class="language-flag">üá≥üá±</div>
                    <div class="language-name">Dutch</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
                <div class="language-card" onclick="selectLanguage('latvian')">
                    <div class="language-flag">üá±üáª</div>
                    <div class="language-name">Latvian</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
                <div class="language-card" onclick="selectLanguage('turkish')">
                    <div class="language-flag">üáπüá∑</div>
                    <div class="language-name">Turkish</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
                <div class="language-card" onclick="selectLanguage('german')">
                    <div class="language-flag">üá©üá™</div>
                    <div class="language-name">German</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
                <div class="language-card" onclick="selectLanguage('lithuanian')">
                    <div class="language-flag">üá±üáπ</div>
                    <div class="language-name">Lithuanian</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
                <div class="language-card" onclick="selectLanguage('polish')">
                    <div class="language-flag">üáµüá±</div>
                    <div class="language-name">Polish</div>
                    <div class="language-level">Beginner ‚Ä¢ 0% Complete</div>
                </div>
            </div>
        </section>

        <!-- Placement Test Section -->
        <section id="test" class="section">
            <div class="test-container">
                <div class="card">
                    <div class="card-header text-center">
                        <h1 class="card-title">Placement Test</h1>
                        <p class="card-subtitle">Let's assess your language level to create a personalized learning path</p>
                    </div>
                </div>

                <div id="testStart">
                    <div class="card text-center">
                        <p class="mb-2">This test will take about 10-15 minutes. We'll test your vocabulary, grammar, and comprehension skills.</p>
                        <button class="btn" onclick="startTest()">
                            <span>‚ñ∂Ô∏è</span> Start Test
                        </button>
                    </div>
                </div>

                <div id="testQuestions" class="hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <div id="questionContainer"></div>
                </div>

                <div id="testResults" class="hidden">
                    <div class="card text-center">
                        <div class="modal-icon">üéâ</div>
                        <h2 class="modal-title">Test Complete!</h2>
                        <p class="mb-2">Your level: <strong id="resultLevel">A2 - Elementary</strong></p>
                        <p id="resultDescription">You have a good basic vocabulary and can handle simple conversations.</p>
                        <button class="btn mt-2" onclick="showSection('lessons')">
                            View My Learning Path
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lessons Section -->
        <section id="lessons" class="section">
            <div class="card">
                <div class="card-header text-center">
                    <h1 class="card-title">Your Personalized Learning Path</h1>
                    <p class="card-subtitle">Complete lessons to unlock new content. First 5 lessons are free!</p>
                </div>
            </div>

            <div class="lesson-path">
                <div class="path-line"></div>
                
                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">1. Greetings & Introductions</div>
                        <div class="lesson-desc">Learn basic greetings and how to introduce yourself</div>
                        <span class="free-badge">FREE</span>
                    </div>
                    <div class="lesson-dot completed">‚úì</div>
                </div>

                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">2. Numbers & Counting</div>
                        <div class="lesson-desc">Master numbers from 1 to 100</div>
                        <span class="free-badge">FREE</span>
                    </div>
                    <div class="lesson-dot completed">‚úì</div>
                </div>

                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">3. Family Members</div>
                        <div class="lesson-desc">Talk about your family and relationships</div>
                        <span class="free-badge">FREE</span>
                    </div>
                    <div class="lesson-dot">3</div>
                </div>

                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">4. Daily Activities</div>
                        <div class="lesson-desc">Describe your daily routine</div>
                        <span class="free-badge">FREE</span>
                    </div>
                    <div class="lesson-dot locked">üîí</div>
                </div>

                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">5. Food & Dining</div>
                        <div class="lesson-desc">Order food and discuss preferences</div>
                        <span class="free-badge">FREE</span>
                    </div>
                    <div class="lesson-dot locked">üîí</div>
                </div>

                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">6. Travel & Directions</div>
                        <div class="lesson-desc">Navigate cities and ask for directions</div>
                        <span style="color: var(--accent); font-size: 0.75rem; display: block; margin-top: 0.5rem;">üîí Premium</span>
                    </div>
                    <div class="lesson-dot locked">üîí</div>
                </div>

                <div class="lesson-node">
                    <div class="lesson-content">
                        <div class="lesson-title">7. Past Tenses</div>
                        <div class="lesson-desc">Talk about past events and experiences</div>
                        <span style="color: var(--accent); font-size: 0.75rem; display: block; margin-top: 0.5rem;">üîí Premium</span>
                    </div>
                    <div class="lesson-dot locked">üîí</div>
                </div>
            </div>
        </section>

        <!-- Admin Dashboard -->
        <section id="admin" class="section">
            <div class="admin-grid">
                <div class="admin-sidebar">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">Admin Menu</h3>
                    <div class="admin-menu-item active" onclick="showAdminTab('content')">üìù Content Editor</div>
                    <div class="admin-menu-item" onclick="showAdminTab('users')">üë• User Management</div>
                    <div class="admin-menu-item" onclick="showAdminTab('stats')">üìä Statistics</div>
                    <div class="admin-menu-item" onclick="showAdminTab('ai')">ü§ñ AI Review</div>
                </div>

                <div class="admin-content">
                    <div id="adminTab-content">
                        <h2>Content Editor</h2>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">Edit and fix lesson content, questions, and translations</p>
                        
                        <div class="content-editor">
                            <div class="editor-field">
                                <label class="editor-label">Select Lesson</label>
                                <select class="editor-input">
                                    <option>1. Greetings & Introductions</option>
                                    <option>2. Numbers & Counting</option>
                                    <option>3. Family Members</option>
                                </select>
                            </div>
                            
                            <div class="editor-field">
                                <label class="editor-label">Question Text</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" class="editor-input" value="How do you say 'Hello' in this language?" style="flex: 1;">
                                    <button class="audio-btn" onclick="speakText('How do you say Hello in this language?')" title="Listen">
                                        üîä
                                    </button>
                                </div>
                            </div>

                            <div class="editor-field">
                                <label class="editor-label">Answer Options</label>
                                <input type="text" class="editor-input mb-2" value="A) Hello">
                                <input type="text" class="editor-input mb-2" value="B) Goodbye">
                                <input type="text" class="editor-input mb-2" value="C) Thank you">
                                <input type="text" class="editor-input" value="D) Please">
                            </div>

                            <div class="editor-field">
                                <label class="editor-label">Correct Answer</label>
                                <select class="editor-input">
                                    <option>A) Hello</option>
                                    <option>B) Goodbye</option>
                                    <option>C) Thank you</option>
                                    <option>D) Please</option>
                                </select>
                            </div>

                            <div class="editor-field">
                                <label class="editor-label">Explanation</label>
                                <textarea class="editor-textarea">'Hello' is the standard greeting used in formal and informal situations.</textarea>
                            </div>

                            <button class="btn" onclick="saveContent()">üíæ Save Changes</button>
                            <button class="btn btn-secondary" onclick="previewContent()">üëÅÔ∏è Preview</button>
                        </div>
                    </div>

                    <div id="adminTab-users" class="hidden">
                        <h2>User Management</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">1,247</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">89%</div>
                                <div class="stat-label">Active This Week</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">456</div>
                                <div class="stat-label">Tests Completed</div>
                            </div>
                        </div>
                    </div>

                    <div id="adminTab-stats" class="hidden">
                        <h2>Platform Statistics</h2>
                        <p>Detailed analytics coming soon...</p>
                    </div>

                    <div id="adminTab-ai" class="hidden">
                        <h2>AI Content Review</h2>
                        <p>Review and approve AI-generated lesson content</p>
                        <div class="card mt-2">
                            <h4 style="color: var(--warning);">‚ö†Ô∏è Pending Review</h4>
                            <p>3 lessons generated by AI need your approval</p>
                            <button class="btn btn-outline mt-2">Review Now</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-icon" id="modalIcon">‚úÖ</div>
            <h3 class="modal-title" id="modalTitle">Success!</h3>
            <p id="modalText">Your changes have been saved.</p>
            <button class="btn mt-2" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        // State Management
        let currentLanguage = null;
        let dyslexiaMode = false;
        let currentQuestion = 0;
        let testAnswers = [];

        // Test Questions
        const testQuestions = [
            {
                question: "Choose the correct translation for 'Hello'",
                options: ["Goodbye", "Hello", "Thank you", "Please"],
                correct: 1
            },
            {
                question: "Which sentence is grammatically correct?",
                options: [
                    "I am go to school",
                    "I going to school",
                    "I go to school",
                    "I to school go"
                ],
                correct: 2
            },
            {
                question: "Select the word that means 'family'",
                options: ["House", "Car", "Family", "Tree"],
                correct: 2
            },
            {
                question: "Complete the sentence: 'Yesterday, I ___ to the cinema.'",
                options: ["go", "went", "gone", "going"],
                correct: 1
            },
            {
                question: "What is the opposite of 'hot'?",
                options: ["Warm", "Cold", "Boiling", "Sunny"],
                correct: 1
            }
        ];

        // Initialize Supabase (replace with your credentials)
        const supabaseUrl = 'YOUR_SUPABASE_URL';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
        let supabase = null;

        try {
            supabase = supabase.createClient(supabaseUrl, supabaseKey);
        } catch (e) {
            console.log('Supabase not configured - running in demo mode');
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Dyslexia Mode Toggle
        function toggleDyslexia() {
            dyslexiaMode = !dyslexiaMode;
            document.body.classList.toggle('dyslexia-mode');
            document.getElementById('dyslexiaSwitch').classList.toggle('active');
            
            // Save preference
            localStorage.setItem('dyslexiaMode', dyslexiaMode);
        }

        // Text to Speech
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = dyslexiaMode ? 0.8 : 1;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            } else {
                showModal('üîä', 'Text-to-Speech', 'Your browser does not support text-to-speech.');
            }
        }

        // Language Selection
        function selectLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.language-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            setTimeout(() => {
                showModal('üéØ', 'Language Selected', `You've selected ${lang.charAt(0).toUpperCase() + lang.slice(1)}. Take a placement test to get started!`);
            }, 300);
        }

        // Test Functions
        function startTest() {
            document.getElementById('testStart').classList.add('hidden');
            document.getElementById('testQuestions').classList.remove('hidden');
            currentQuestion = 0;
            testAnswers = [];
            showQuestion();
        }

        function showQuestion() {
            const q = testQuestions[currentQuestion];
            const progress = ((currentQuestion + 1) / testQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const container = document.getElementById('questionContainer');
            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestion + 1} of ${testQuestions.length}</span>
                        <button class="audio-btn" onclick="speakText('${q.question.replace(/'/g, "\\'")}')" title="Listen to question">
                            üîä
                        </button>
                    </div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid">
                        ${q.options.map((opt, idx) => `
                            <div class="option" onclick="selectAnswer(${idx})">
                                <div class="option-letter">${String.fromCharCode(65 + idx)}</div>
                                <div>${opt}</div>
                                <button class="audio-btn" onclick="event.stopPropagation(); speakText('${opt.replace(/'/g, "\\'")}')" title="Listen" style="margin-left: auto;">
                                    üîä
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function selectAnswer(answerIndex) {
            testAnswers.push(answerIndex);
            
            if (currentQuestion < testQuestions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('testQuestions').classList.add('hidden');
            document.getElementById('testResults').classList.remove('hidden');
            
            // Calculate level based on correct answers
            let correct = 0;
            testAnswers.forEach((ans, idx) => {
                if (ans === testQuestions[idx].correct) correct++;
            });
            
            const percentage = (correct / testQuestions.length) * 100;
            let level = 'A1 - Beginner';
            let desc = 'You are just starting your language journey. We recommend starting with the basics.';
            
            if (percentage >= 80) {
                level = 'B1 - Intermediate';
                desc = 'Great job! You have a solid foundation and can handle everyday conversations.';
            } else if (percentage >= 60) {
                level = 'A2 - Elementary';
                desc = 'You have a good basic vocabulary and can handle simple conversations.';
            }
            
            document.getElementById('resultLevel').textContent = level;
            document.getElementById('resultDescription').textContent = desc;
            
            // Save to Supabase if available
            if (supabase) {
                saveTestResults(level, percentage);
            }
        }

        async function saveTestResults(level, score) {
            try {
                const { data, error } = await supabase
                    .from('test_results')
                    .insert([
                        { 
                            user_id: 'demo-user',
                            language: currentLanguage,
                            level: level,
                            score: score,
                            created_at: new Date()
                        }
                    ]);
                
                if (error) throw error;
                console.log('Results saved:', data);
            } catch (error) {
                console.error('Error saving results:', error);
            }
        }

        // Admin Functions
        function showAdminTab(tab) {
            document.querySelectorAll('[id^="adminTab-"]').forEach(t => t.classList.add('hidden'));
            document.getElementById('adminTab-' + tab).classList.remove('hidden');
            
            document.querySelectorAll('.admin-menu-item').forEach(i => i.classList.remove('active'));
            event.target.classList.add('active');
        }

        function saveContent() {
            showModal('üíæ', 'Saved!', 'Your content changes have been saved successfully.');
        }

        function previewContent() {
            showModal('üëÅÔ∏è', 'Preview Mode', 'Opening preview in new window...');
        }

        // Modal Functions
        function showModal(icon, title, text) {
            document.getElementById('modalIcon').textContent = icon;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').textContent = text;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Initialize
        window.onload = function() {
            // Check for saved dyslexia preference
            if (localStorage.getItem('dyslexiaMode') === 'true') {
                toggleDyslexia();
            }
        };

        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>
</body>
</html>
